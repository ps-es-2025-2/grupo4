# Descrição Detalhada dos Casos de Uso

## Sumário

- [UC01: Cadastrar Novo Paciente](#uc01-cadastrar-novo-paciente)
- [UC02: Agendar Consulta](#uc02-agendar-consulta)
- [UC03: Solicitar Encaixe](#uc03-solicitar-encaixe)
- [UC04: Registrar Bloqueio de Agenda](#uc04-registrar-bloqueio-de-agenda)
- [UC05: Dar Baixa em Insumos](#uc05-dar-baixa-em-insumos)
- [UC06: Processar Entrada de NF/Itens](#uc06-processar-entrada-de-nf-itens)
- [UC07: Gerar Alerta de Estoque Crítico](#uc07-gerar-alerta-de-estoque-crítico)
- [UC08: Consultar Histórico do Paciente](#uc08-consultar-histórico-do-paciente)
- [UC09: Cancelar Agendamento](#uc09-cancelar-agendamento)
- [UC10: Controlar Validade de Itens](#uc10-controlar-validade-de-itens)
- [UC11: Gerenciar Usuários e Perfis de Acesso](#uc11-gerenciar-usuários-e-perfis-de-acesso)
- [UC12: Gerenciar Cadastros Base do Sistema](#uc12-gerenciar-cadastros-base-do-sistema)

---

## UC01: Cadastrar Novo Paciente

**Nome**: Cadastrar Novo Paciente

**Descrição**: O sistema registra um novo paciente, verificando a unicidade do CPF e associando-o, opcionalmente, a um Convênio.

**Atores**: Secretária (Herda de Administrativo).

### Pré-condições

O usuário deve estar autenticado e ter permissão de cadastro.
O Convênio (se aplicável) deve estar previamente cadastrado e ativo.

### Pós-condições

É criado um novo registro de Paciente e de Pessoa.
O CPF é marcado como único no banco de dados.

### Fluxo Básico

A Secretária acessa a funcionalidade de Cadastro de Pacientes.
O usuário preenche os dados da Pessoa (Nome, Telefone, Email).
O usuário preenche os dados de Paciente (CPF, Data de Nascimento).
O Sistema valida o formato e a unicidade do CPF.
Opcionalmente, o usuário associa o paciente a um Convênio e Plano.
O usuário confirma o cadastro.
O Sistema salva o novo registro no módulo de Cadastro.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 5 – Cadastro sem Convênio: O usuário opta por não associar um convênio, e o cadastro prossegue sem essa informação.

### Fluxos de Exceção

(E1) Exceção ao Passo 4 – CPF Duplicado: O Sistema detecta que o CPF já está registrado. O Sistema exibe a mensagem "CPF já cadastrado. Verifique o paciente [Nome]." O caso de uso é encerrado.

### Regras de Negócio

(RN-CAD.1) O campo CPF é obrigatório e deve ser único no sistema.
(RN-CAD.2) A data de nascimento é obrigatória para validações de idade e fins estatísticos.

---

## UC02: Agendar Consulta

**Nome**: Agendar Consulta

**Descrição**: O sistema registra uma nova Consulta (tipo de Agendamento) vinculando um Paciente a um Médico em um horário disponível.

**Atores**: Secretária.

### Pré-condições

O Paciente e o Médico devem estar cadastrados e ativos.
O horário selecionado não deve estar coberto por outro Agendamento ou BlocoAgenda.

### Pós-condições

Um novo registro de Consulta/Agendamento é criado no sistema.
O status do horário na agenda do Médico é atualizado para "Ocupado".

### Fluxo Básico

A Secretária acessa a agenda do Médico desejado.
O usuário seleciona a data e hora desejadas.
O Sistema consulta o AgendamentoService para verificar a disponibilidade.
O usuário pesquisa e seleciona o Paciente (ex: por CPF) usando o CadastroService.
O usuário informa o TipoConsulta (ex: primeira, retorno) e, se aplicável, o Convênio.
O usuário confirma o Agendamento.
O Sistema salva a Consulta no AgendamentoDAO.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 – Paciente Não Encontrado: O Sistema oferece a opção de iniciar o UC01 (Cadastrar Novo Paciente).

### Fluxos de Exceção

(E1) Exceção ao Passo 3 – Conflito de Agenda: O Sistema detecta um conflito (outro Agendamento ou BlocoAgenda). O Sistema exibe a mensagem "Horário indisponível. Conflito com [Detalhe do Conflito]." O caso de uso é encerrado.

### Regras de Negócio

(RN-AGENDA.1) Um Agendamento deve ter um Médico e um Paciente válidos e ativos.
(RN-AGENDA.2) Se o Paciente tiver Convênio, o Agendamento deve estar associado a um Convênio que o Médico atenda.

---

## UC03: Solicitar Encaixe

**Nome**: Solicitar Encaixe

**Descrição**: O sistema permite a criação de um Agendamento em um horário formalmente bloqueado, requerendo uma justificativa e permissão do ator.

**Atores**: Profissional de Saúde (Médico), Secretária (Herda de Profissional de Saúde).

### Pré-condições

O Agendamento deve falhar na checagem de disponibilidade (coberto por um BlocoAgenda ou outro Agendamento).
O usuário deve ter a permissão temPermissaoEncaixe() == true ou obter aprovação.

### Pós-condições

Um Agendamento é criado com a flag isEncaixe = true.
O campo motivoEncaixe é preenchido no Agendamento.

### Fluxo Básico

O Ator tenta realizar o UC02 (Agendar Consulta), mas a verificação de disponibilidade falha.
O Sistema identifica a falha e pergunta "Deseja solicitar um encaixe?".
O Ator confirma e preenche o motivoEncaixe.
O Sistema verifica a permissão do Ator (temPermissaoEncaixe()).
Se a permissão for concedida, o Sistema salva o Agendamento com o flag isEncaixe = true.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 – Requer Aprovação do Médico: Se a Secretária estiver solicitando, o Sistema envia o pedido de encaixe para o Médico, que deve aprovar ou rejeitar o Agendamento.

### Fluxos de Exceção

(E1) Exceção ao Passo 4 – Permissão Negada: O Sistema detecta que o Ator não possui permissão para realizar encaixe. O Sistema exibe a mensagem "Usuário sem permissão para realizar encaixes." O caso de uso é encerrado.

### Regras de Negócio

(RN-ENCAIXE.1) O encaixe deve sempre ter um motivoEncaixe preenchido.
(RN-ENCAIXE.2) O encaixe deve ser sempre autorizado, seja por permissão direta, seja por aprovação de um superior.

---

## UC04: Registrar Bloqueio de Agenda

**Nome**: Registrar Bloqueio de Agenda

**Descrição**: O sistema permite ao Médico ou Gestor reservar um período na agenda do médico (ex: férias, treinamento) impedindo novos agendamentos naquele intervalo.

**Atores**: Médico, Gestor (Herda de Administrativo).

### Pré-condições

O usuário deve estar autenticado.
O período a ser bloqueado não pode ter Agendamentos confirmados (status "Ativo").

### Pós-condições

É criado um novo registro de BlocoAgenda vinculado ao Médico.
O horário bloqueado é refletido na visualização da agenda como indisponível para UC02.

### Fluxo Básico

O Ator acessa a função de Gestão de Bloqueio de Agenda.
O usuário seleciona o Médico e informa o intervalo de dataInicio e dataFim.
O usuário preenche o motivo do bloqueio.
O Sistema verifica a existência de Agendamentos Ativos no período selecionado.
O usuário confirma o bloqueio.
O Sistema salva o novo BlocoAgenda no AgendamentoDAO.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 2 – Bloqueio Recorrente: O usuário define uma recorrência (ex: semanalmente) para o bloqueio, e o Sistema gera múltiplos registros de BlocoAgenda.

### Fluxos de Exceção

(E1) Exceção ao Passo 4 – Conflito com Agendamento Existente: O Sistema identifica que existem Agendamentos ativos no período. O Sistema exibe a mensagem "Bloqueio não permitido. [X] agendamentos ativos devem ser cancelados (UC09) ou reagendados primeiro." O caso de uso é encerrado.

### Regras de Negócio

(RN-BLOQ.1) O motivo do bloqueio é obrigatório.
(RN-BLOQ.2) Apenas o Médico ou um Gestor podem registrar um BlocoAgenda para um Médico.

---

## UC05: Dar Baixa em Insumos

**Nome**: Dar Baixa em Insumos

**Descrição**: O sistema registra o consumo de um Item (Medicamento, Hospitalar) do Estoque e atualiza o saldo, garantindo que o item não esteja vencido.

**Atores**: Profissional de Saúde (Médico), Secretária (Herda de Administrativo e Profissional de Saúde).

### Pré-condições

O Item deve estar cadastrado no Estoque.
Deve haver quantidade disponível e válida no Estoque.

### Pós-condições

A quantidadeTotal do Item é reduzida no Estoque.
É gerado um registro de movimentação de saída no módulo de Estoque.
O Sistema verifica o Estoque Crítico (UC07).

### Fluxo Básico

O Ator acessa a funcionalidade de Baixa de Estoque.
O usuário pesquisa e seleciona o Item (ex: por código).
O Sistema informa o saldo atual e a validade mais próxima.
O usuário informa a quantidadeNecessaria para a baixa e o destino do consumo (ex: Agendamento ID).
O Sistema consulta o EstoqueDAO para verificar a validade e a disponibilidade.
O Sistema atualiza a quantidadeTotal do Item no Estoque.
O Sistema dispara a verificação de Estoque Crítico (UC07).
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 – Baixa por Lote: O usuário seleciona especificamente o lote do qual a baixa será efetuada, priorizando o item de validade mais antiga.

### Fluxos de Exceção

(E1) Exceção ao Passo 5 – Item Vencido: O Sistema detecta que o lote com a menor validade está vencido. O Sistema exibe "Item vencido. Selecione outro lote ou proceda ao descarte (UC10)." A baixa é negada.
(E2) Exceção ao Passo 5 – Estoque Insuficiente: O Sistema detecta que a quantidadeTotal é menor que a quantidade solicitada. O Sistema exibe "Estoque insuficiente. Disponível: [X]." O caso de uso é encerrado.

### Regras de Negócio

(RN-BAIXA.1) O consumo deve ser rastreável (vinculado a um procedimento, consulta, ou área).
(RN-BAIXA.2) Deve ser aplicada a regra FIFO (First-In, First-Out) ou FEFO (First-Expired, First-Out) ao selecionar o lote.

---

## UC06: Processar Entrada de NF/Itens

**Nome**: Processar Entrada de NF/Itens

**Descrição**: O sistema registra a entrada de novos Itens no Estoque, associando-os a uma Nota Fiscal (NF), Fornecedor e Pedido.

**Atores**: Secretária, Gestor (Herda de Administrativo).

### Pré-condições

O Fornecedor deve estar cadastrado.
A Nota Fiscal (NF) deve ser única no sistema.

### Pós-condições

A quantidadeTotal do Item é incrementada.
É gerado um registro de movimentação de entrada.
O status do Pedido (se existir) pode ser atualizado para "Recebido Parcialmente/Totalmente".

### Fluxo Básico

O Ator acessa a função de Entrada de Estoque.
O usuário informa o NF (Número da Nota Fiscal) e seleciona o Fornecedor.
O usuário insere a lista de Itens recebidos (código, quantidade, validade, lote).
O Sistema consulta o EstoqueService para verificar a existência do Item e se a validade é aceitável (não muito curta).
O Sistema incrementa a quantidadeTotal do Item no EstoqueDAO e registra o novo lote.
O Sistema dispara a verificação de Estoque Crítico (UC07).
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 3 – Entrada de Novo Item: O Item não é encontrado no cadastro. O Sistema oferece a opção de cadastrar o novo Item antes de prosseguir com a entrada.

### Fluxos de Exceção

(E1) Exceção ao Passo 4 – Validade Curta: O Sistema detecta um Item com data de validade inferior a 30 dias. O Sistema exige confirmação do Gestor e registra um alerta de risco.
(E2) Exceção ao Passo 2 – NF Duplicada: O Sistema detecta que o número de NF já foi processado. O Sistema exibe "Nota Fiscal já registrada." O caso de uso é encerrado.

### Regras de Negócio

(RN-ENTRADA.1) A rastreabilidade por lote e validade é obrigatória para todos os Itens (RN-ESTOQUE.3).
(RN-ENTRADA.2) A entrada deve ser vinculada à Conta a Pagar gerada pela compra (Módulo Financeiro).

---

## UC07: Gerar Alerta de Estoque Crítico

**Nome**: Gerar Alerta de Estoque Crítico

**Descrição**: O sistema verifica a quantidade de Itens no Estoque e notifica o Gestor se o saldo cair abaixo do ponto de reposição configurado.

**Atores**: Sistema, Gestor.

### Pré-condições

O ponto de reposição (estoque mínimo) deve estar configurado para cada Item.
O cálculo é geralmente acionado após uma baixa (UC05) ou entrada (UC06).

### Pós-condições

É gerado um registro de alerta no sistema.
O Gestor é notificado (ex: notificação interna, email).

### Fluxo Básico

O Sistema (em background ou acionado por UC05/UC06) inicia a verificação.
O Sistema percorre todos os Itens ativos.
O Sistema compara a quantidadeTotal com o Ponto de Reposição configurado.
Se a quantidadeTotal < Ponto de Reposição, o Sistema gera o alerta e registra o evento.
O Sistema notifica o Gestor sobre o Item, a quantidade atual e a necessidade de reposição.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 5 – Sugestão de Pedido: O Sistema oferece um botão/opção para o Gestor gerar um rascunho de Pedido de Compra para o Item crítico.

### Fluxos de Exceção

(E1) Exceção ao Passo 3 – Ponto de Reposição Não Configurado: O Sistema lista os Itens sem configuração, mas não gera alerta para eles.

### Regras de Negócio

(RN-ALERTA.1) A notificação deve ser imediata ou ocorrer em intervalos definidos (ex: consolidado a cada hora).
(RN-ALERTA.2) Itens com validade próxima (UC10) também devem ser considerados no cálculo de estoque crítico, mesmo que a quantidade seja alta.

---

## UC08: Consultar Histórico do Paciente

**Nome**: Consultar Histórico do Paciente

**Descrição**: O sistema permite a consulta consolidada do cadastro, agendamentos passados/futuros e procedimentos/exames realizados para um paciente.

**Atores**: Secretária, Profissional de Saúde (Médico).

### Pré-condições

O Paciente deve estar cadastrado.
O Ator deve ter permissão de acesso ao nível de detalhe desejado (ex: Médico pode ver dados clínicos, Secretária pode ver apenas agendamentos).

### Pós-condições

O Ator visualiza o histórico consolidado.

### Fluxo Básico

O Ator acessa a função de Consulta de Pacientes.
O usuário pesquisa o Paciente (por CPF, Nome ou ID).
O Sistema exibe os dados cadastrais (Pessoa, Paciente, Convênio).
O Sistema consolida a lista de Agendamentos (passados e futuros).
O Sistema exibe os resultados de Procedimento, Exame e os insumos baixados (UC05) vinculados aos Agendamentos realizados.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 5 – Filtro de Documentos: O usuário pode filtrar o histórico para exibir apenas Exames ou apenas Agendamentos de um tipo específico.

### Fluxos de Exceção

(E1) Exceção ao Passo 2 – Paciente Não Encontrado: O Sistema exibe "Nenhum paciente encontrado com os critérios de busca." O caso de uso é encerrado.
(E2) Exceção ao Passo 5 – Permissão Negada: Se a Secretária tentar acessar dados clínicos, o Sistema exibe "Acesso restrito. Conteúdo confidencial." e oculta o detalhe clínico.

### Regras de Negócio

(RN-HIST.1) A consulta deve buscar dados de todos os módulos (Cadastro, Agendamento, Estoque, Financeiro) de forma integrada.
(RN-HIST.2) O acesso a dados sensíveis é determinado pela PerfilUsuario do Ator.

---

## UC09: Cancelar Agendamento

**Nome**: Cancelar Agendamento

**Descrição**: O sistema altera o status de um Agendamento ativo para "Cancelado", liberando o horário na agenda do Médico e registrando o motivo.

**Atores**: Secretária, Médico, Gestor (Herda de Administrativo).

### Pré-condições

O Agendamento deve estar ativo e agendado para o futuro.

### Pós-condições

O status do Agendamento é alterado para "Cancelado".
O horário na agenda do Médico é liberado para um novo UC02.
É registrado um motivo de cancelamento.

### Fluxo Básico

O Ator acessa o Agendamento a ser cancelado (via UC08 ou agenda).
O usuário seleciona a opção "Cancelar Agendamento".
O usuário informa o motivo do cancelamento.
O Sistema verifica a antecedência do cancelamento (RN-AGENDA.3).
O Sistema exibe uma confirmação de segurança.
O Sistema atualiza o status do Agendamento para "Cancelado".
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 – Reagendamento: O usuário pode optar por "Cancelar e Reagendar" em uma única transação (inicia o fluxo do UC02).

### Fluxos de Exceção

(E1) Exceção ao Passo 4 – Agendamento Próximo: Se o cancelamento ocorrer fora do prazo (ex: 15 minutos antes), o Sistema registra o evento como "Cancelamento Tarde" para fins estatísticos e pode aplicar uma penalidade (Módulo Financeiro).
(E2) Exceção ao Passo 1 – Agendamento Já Realizado: O Sistema detecta que o Agendamento já foi baixado como "Realizado". O Sistema exibe "Não é possível cancelar um agendamento já realizado." O caso de uso é encerrado.

### Regras de Negócio

(RN-AGENDA.3) Agendamentos cancelados devem registrar se o cancelamento foi dentro ou fora do prazo.
(RN-AGENDA.4) O Agendamento só pode ser cancelado se o status não for "Realizado" ou "Não Compareceu".

---

## UC10: Controlar Validade de Itens

**Nome**: Controlar Validade de Itens

**Descrição**: O sistema identifica Itens no Estoque cuja validade está próxima ou expirada e permite sua separação e baixa para descarte.

**Atores**: Gestor (Herda de Administrativo), Sistema.

### Pré-condições

Os Itens devem ter a data de validade e lote registrados.
Regras de descarte e antecedência para alerta devem estar configuradas.

### Pós-condições

É gerado um relatório ou lista de itens vencidos/próximos.
O saldo de Itens descartados é deduzido da quantidadeTotal do Estoque (Baixa por Descarte).

### Fluxo Básico

O Gestor acessa a função de Controle de Validade.
O usuário informa o critério de busca (ex: Vence nos Próximos 30 dias ou Vencidos).
O Sistema busca todos os Itens no Estoque (via EstoqueDAO) que atendem ao critério.
O Sistema exibe a lista, detalhando o nome, validade, lote e quantidade.
O Gestor seleciona os Itens que serão descartados e confirma a ação.
O Sistema registra a saída por descarte e atualiza o saldo do Estoque (analogia ao UC05, mas com tipo de movimentação "Descarte").
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 1 – Verificação Automática: O Sistema executa a verificação (igual ao UC07, mas focada em validade) periodicamente e envia um relatório ao Gestor.

### Fluxos de Exceção

(E1) Exceção ao Passo 3 – Nenhum Item Encontrado: O Sistema exibe "Nenhum item encontrado no critério de validade." O caso de uso é encerrado.

### Regras de Negócio

(RN-ESTOQUE.3) Itens vencidos (validade < data atual) devem ser removidos do saldo disponível para Baixa de Insumos (UC05).
(RN-ESTOQUE.4) A baixa por descarte deve ser registrada com um código de custo (Módulo Financeiro).

---

## UC11: Gerenciar Usuários e Perfis de Acesso

**Nome**: Gerenciar Usuários e Perfis de Acesso DESCRIÇÃO SUCINTA: O sistema permite a criação, modificação e desativação de contas de usuários (Médico, Secretária, Gestor), atribuindo o perfil de acesso e permissões específicas. ATORES: Gestor (Herda de Administrativo).

### Pré-condições

O Gestor deve estar autenticado.
Os perfis de acesso (PerfilUsuario) devem estar configurados no sistema.

### Pós-condições

É criado/atualizado um registro de Usuario e Pessoa (incluindo Medico se aplicável).
O PerfilUsuario e as permissões são definidos.

### Fluxo Básico

O Gestor acessa a funcionalidade de Gestão de Usuários.
O usuário seleciona a opção "Cadastrar Novo Usuário" ou "Buscar/Editar Usuário Existente".
O usuário preenche os dados da Pessoa (Nome, Telefone, Email) e do Usuario (Login e Senha).
O usuário seleciona o PerfilUsuario (Médico, Secretária, Gestor).
Se o Perfil for Médico: O usuário preenche os dados específicos (CRM, Especialidade).
O usuário define as permissões adicionais (ex: temPermissaoEncaixe()).
O Sistema valida a unicidade do Login e do CRM (se aplicável).
O usuário confirma o cadastro/atualização.
O Sistema salva os registros nos módulos de Cadastro.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 2 – Desativação de Usuário: O usuário busca um usuário e altera seu status para "Inativo" em vez de excluí-lo, preservando o histórico de ações.

### Fluxos de Exceção

(E1) Exceção ao Passo 7 – Login Duplicado: O Sistema detecta que o Login ou o CRM (se Médico) já estão em uso. O Sistema exibe a mensagem "Login/CRM já cadastrado." O caso de uso é encerrado.

### Regras de Negócio

(RN-USER.1) A senha deve atender a critérios de segurança (ex: tamanho mínimo, caracteres especiais). (RN-USER.2) Apenas o Gestor pode criar ou editar o perfil de outro Gestor.

---

## UC12: Gerenciar Cadastros Base do Sistema

**Nome**: Gerenciar Cadastros Base do Sistema

**Descrição**: O sistema permite a manutenção dos cadastros de entidades primárias necessárias para os outros módulos: Convenios, Itens (Medicamentos/Hospitalares) e Fornecedores.

**Atores**: Secretária, Gestor.

### Pré-condições

O usuário deve estar autenticado.

### Pós-condições

É criado/atualizado um registro nas classes Convenio, Item (ou suas subclasses) ou Fornecedor.

### Fluxo Básico

O Ator acessa a funcionalidade de Gestão de Cadastros Base.
O usuário seleciona o tipo de cadastro a ser gerenciado (Convênio, Item ou Fornecedor).
O usuário seleciona "Novo Cadastro" ou "Editar Existente".
O usuário preenche os dados específicos da entidade (ex: CNPJ para Fornecedor, nome e plano para Convênio, nome e tipo para Item).
O Sistema valida a unicidade dos campos chave (CNPJ, nome do Convênio, código do Item).
O usuário confirma o cadastro/atualização.
O Sistema salva o registro no módulo correspondente.
O caso de uso é encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 3 – Importação em Massa: O usuário opta por importar uma lista de itens de uma planilha, e o Sistema processa e valida os dados antes de salvar.

### Fluxos de Exceção

(E1) Exceção ao Passo 5 – CNPJ/Código Duplicado: O Sistema detecta que o campo de unicidade já está registrado. O Sistema exibe a mensagem "Cadastro duplicado. Verifique o registro existente." O caso de uso é encerrado.

### Regras de Negócio

(RN-BASE.1) O CNPJ do Fornecedor é obrigatório e único. (RN-BASE.2) Itens devem ser categorizados corretamente (Medicamento, Hospitalar, etc.) para fins de rastreabilidade e controle de validade (RN-ESTOQUE.3). (RN-BASE.3) Um Convênio inativo não pode ser selecionado em novos Agendamentos (UC02).

---

