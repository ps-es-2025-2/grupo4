# Descri√ß√£o Detalhada dos Casos de Uso

## Sum√°rio

- [Notas T√©cnicas - Corre√ß√µes de Discrep√¢ncias](#notas-t√©cnicas---corre√ß√µes-de-discrep√¢ncias)
- [UC01: Cadastrar Novo Paciente](#uc01-cadastrar-novo-paciente)
- [UC02: Agendar Consulta](#uc02-agendar-consulta)
- [UC03: Solicitar Encaixe](#uc03-solicitar-encaixe)
- [UC04: Registrar Bloqueio de Agenda](#uc04-registrar-bloqueio-de-agenda)
- [UC05: Dar Baixa em Insumos](#uc05-dar-baixa-em-insumos)
- [UC06: Processar Entrada de NF/Itens](#uc06-processar-entrada-de-nfitens)
- [UC07: Gerar Alerta de Estoque Cr√≠tico](#uc07-gerar-alerta-de-estoque-cr√≠tico)
- [UC08: Consultar Hist√≥rico do Paciente](#uc08-consultar-hist√≥rico-do-paciente)
- [UC09: Cancelar Agendamento](#uc09-cancelar-agendamento)
- [UC10: Controlar Validade de Itens](#uc10-controlar-validade-de-itens)
- [UC11: Gerenciar Usu√°rios e Perfis de Acesso](#uc11-gerenciar-usu√°rios-e-perfis-de-acesso)
- [UC12: Gerenciar Cadastros Base do Sistema](#uc12-gerenciar-cadastros-base-do-sistema)

---

## Notas T√©cnicas - Corre√ß√µes de Discrep√¢ncias

Este documento foi atualizado para corrigir discrep√¢ncias identificadas entre a documenta√ß√£o e a implementa√ß√£o real do sistema.

### Discrep√¢ncia 3.3: Integra√ß√£o AgendamentoService ‚Üí CadastroService

**Discrep√¢ncia:** Documenta√ß√£o indicava depend√™ncias diretas entre `AgendamentoService` e `CadastroService`/`EstoqueService`, mas implementa√ß√£o usa Redis Pub/Sub e strings identificadoras.

**Mudan√ßa Feita:** Removidas depend√™ncias diretas entre servi√ßos. Documentado uso de pacienteCpf, medicoCrm (strings) e Redis Pub/Sub para integra√ß√£o ass√≠ncrona.

**Justificativa:** Arquitetura de microservi√ßos com Database per Service. Zero imports entre m√≥dulos no backend.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_3.3.md](../../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_3.3.md)

### Discrep√¢ncia 3.4: Integra√ß√£o AgendamentoService ‚Üí EstoqueService (Baixa em Insumos)

**Discrep√¢ncia:** Documenta√ß√£o mostrava `AgendamentoService` com atributo `estoqueService` e m√©todo `darBaixaEmMateriais()`, mas UC05 √© independente no m√≥dulo Estoque.

**Mudan√ßa Feita:** Removidos atributo estoqueService e m√©todo darBaixaEmMateriais() de AgendamentoService. UC08 simplificado para retornar apenas dados de agendamentos. RN-HIST.1 marcada como [REDU√á√ÉO DE ESCOPO].

**Justificativa:** DarBaixaInsumosUseCase existe SOMENTE no m√≥dulo Estoque, sem integra√ß√£o com Agendamento.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_3.4.md](../../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_3.4.md)

### Discrep√¢ncia 5.1: UC07 - Gerar Alerta de Estoque Cr√≠tico

**Discrep√¢ncia:** UC07 documentado como completo, mas n√£o implementado (0% funcional). Publisher existe, subscriber n√£o.

**Mudan√ßa Feita:** UC07 marcado como `[N√ÉO IMPLEMENTADO]`. RN-ALERTA.1 e RN-ALERTA.2 marcadas. Refer√™ncias em UC05 e UC06 atualizadas.

**Justificativa:** EstoqueAlertaPublisher.solicitarAlertasEstoqueCritico() existe no Cadastro, mas nenhum @RedisListener no Estoque responde ao canal.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_5.1.md](../../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_5.1.md)

### Discrep√¢ncia 5.2: UC08 - Consultar Hist√≥rico do Paciente

**Discrep√¢ncia:** UC08 documentado com integra√ß√£o completa de 5 m√≥dulos, mas apenas 3 de 5 canais Redis funcionam (60% funcional).

**Mudan√ßa Feita:** UC08 marcado como `[IMPLEMENTA√á√ÉO PARCIAL]`. Cabe√ßalho e Passo 5 do fluxo atualizados explicando quais canais funcionam (consultas, exames, procedimentos) e quais n√£o funcionam (estoque, pagamentos).

**Justificativa:** ConsultarHistoricoPacienteUseCase publica 5 requests, AgendamentoSubscriber responde 3, EstoqueSubscriber n√£o existe, M√≥dulo Financeiro n√£o existe.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_5.2.md](../../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_5.2.md)

### Discrep√¢ncia 5.3: UC10 - Controlar Validade de Itens

**Discrep√¢ncia:** UC10 documentado com persist√™ncia de descartes, mas movimenta√ß√µes n√£o s√£o salvas em BD (50% funcional).

**Mudan√ßa Feita:** UC10 marcado como `[IMPLEMENTA√á√ÉO PARCIAL]`. RN-ESTOQUE.4 atualizada explicando que c√≥digo de custo √© validado mas n√£o registrado.

**Justificativa:** ControlarValidadeUseCase.execute() funciona, endpoint `/validade` operacional, mas `registrarMovimentacaoDescarte()` apenas imprime logs no console.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_5.3.md](../../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_5.3.md)

---

Para consultar todas as corre√ß√µes de discrep√¢ncias do projeto, acesse o [üìë Sum√°rio de Corre√ß√µes](../../../Corre√ß√µes%20de%20Alinhamento/SUMARIO_CORRECAO_DISCREPANCIA.md).

---

## UC01: Cadastrar Novo Paciente

**Nome**: Cadastrar Novo Paciente

**Descri√ß√£o**: O sistema registra um novo paciente, verificando a unicidade do CPF e associando-o, opcionalmente, a um Conv√™nio.

**Atores**: Secret√°ria (Herda de Administrativo).

### Pr√©-condi√ß√µes

O usu√°rio deve estar autenticado e ter permiss√£o de cadastro.
O Conv√™nio (se aplic√°vel) deve estar previamente cadastrado e ativo.

### P√≥s-condi√ß√µes

√â criado um novo registro de Paciente e de Pessoa.
O CPF √© marcado como √∫nico no banco de dados.

### Fluxo B√°sico

A Secret√°ria acessa a funcionalidade de Cadastro de Pacientes.
O usu√°rio preenche os dados da Pessoa (Nome, Telefone, Email).
O usu√°rio preenche os dados de Paciente (CPF, Data de Nascimento).
O Sistema valida o formato e a unicidade do CPF.
Opcionalmente, o usu√°rio associa o paciente a um Conv√™nio e Plano.
O usu√°rio confirma o cadastro.
O Sistema salva o novo registro no m√≥dulo de Cadastro.
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 5 ‚Äì Cadastro sem Conv√™nio: O usu√°rio opta por n√£o associar um conv√™nio, e o cadastro prossegue sem essa informa√ß√£o.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 4 ‚Äì CPF Duplicado: O Sistema detecta que o CPF j√° est√° registrado. O Sistema exibe a mensagem "CPF j√° cadastrado. Verifique o paciente [Nome]." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-CAD.1) O campo CPF √© obrigat√≥rio e deve ser √∫nico no sistema.
(RN-CAD.2) A data de nascimento √© obrigat√≥ria para valida√ß√µes de idade e fins estat√≠sticos.

---

## UC02: Agendar Consulta

**Nome**: Agendar Consulta

**Descri√ß√£o**: O sistema registra uma nova Consulta (tipo de Agendamento) vinculando um Paciente a um M√©dico em um hor√°rio dispon√≠vel.

**Atores**: Secret√°ria.

### Pr√©-condi√ß√µes

O Paciente e o M√©dico devem estar cadastrados e ativos.
O hor√°rio selecionado n√£o deve estar coberto por outro Agendamento ou BlocoAgenda.

### P√≥s-condi√ß√µes

Um novo registro de Consulta/Agendamento √© criado no sistema.
O status do hor√°rio na agenda do M√©dico √© atualizado para "Ocupado".

### Fluxo B√°sico

A Secret√°ria acessa a agenda do M√©dico desejado.
O usu√°rio seleciona a data e hora desejadas.
O Sistema consulta o AgendamentoService para verificar a disponibilidade.
O usu√°rio pesquisa e seleciona o Paciente (ex: por CPF) usando o CadastroService.
O usu√°rio informa o TipoConsulta (ex: primeira, retorno) e, se aplic√°vel, o Conv√™nio.
O usu√°rio confirma o Agendamento.
O Sistema salva a Consulta no AgendamentoRepository.
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 ‚Äì Paciente N√£o Encontrado: O Sistema oferece a op√ß√£o de iniciar o UC01 (Cadastrar Novo Paciente).

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 3 ‚Äì Conflito de Agenda: O Sistema detecta um conflito (outro Agendamento ou BlocoAgenda). O Sistema exibe a mensagem "Hor√°rio indispon√≠vel. Conflito com [Detalhe do Conflito]." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-AGENDA.1) Um Agendamento deve ter um M√©dico e um Paciente v√°lidos e ativos.
(RN-AGENDA.2) Se o Paciente tiver Conv√™nio, o Agendamento deve estar associado a um Conv√™nio que o M√©dico atenda.

---

## UC03: Solicitar Encaixe

**Nome**: Solicitar Encaixe

**Descri√ß√£o**: O sistema permite a cria√ß√£o de um Agendamento em um hor√°rio formalmente bloqueado, requerendo uma justificativa e permiss√£o do ator.

**Atores**: Profissional de Sa√∫de (M√©dico), Secret√°ria (Herda de Profissional de Sa√∫de).

### Pr√©-condi√ß√µes

O Agendamento deve falhar na checagem de disponibilidade (coberto por um BlocoAgenda ou outro Agendamento).
O usu√°rio deve ter a permiss√£o temPermissaoEncaixe() == true ou obter aprova√ß√£o.

### P√≥s-condi√ß√µes

Um Agendamento √© criado com a flag isEncaixe = true.
O campo motivoEncaixe √© preenchido no Agendamento.

### Fluxo B√°sico

O Ator tenta realizar o UC02 (Agendar Consulta), mas a verifica√ß√£o de disponibilidade falha.
O Sistema identifica a falha e pergunta "Deseja solicitar um encaixe?".
O Ator confirma e preenche o motivoEncaixe.
O Sistema verifica a permiss√£o do Ator (temPermissaoEncaixe()).
Se a permiss√£o for concedida, o Sistema salva o Agendamento com o flag isEncaixe = true.
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 ‚Äì Requer Aprova√ß√£o do M√©dico: Se a Secret√°ria estiver solicitando, o Sistema envia o pedido de encaixe para o M√©dico, que deve aprovar ou rejeitar o Agendamento.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 4 ‚Äì Permiss√£o Negada: O Sistema detecta que o Ator n√£o possui permiss√£o para realizar encaixe. O Sistema exibe a mensagem "Usu√°rio sem permiss√£o para realizar encaixes." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-ENCAIXE.1) O encaixe deve sempre ter um motivoEncaixe preenchido.
(RN-ENCAIXE.2) O encaixe deve ser sempre autorizado, seja por permiss√£o direta, seja por aprova√ß√£o de um superior.

---

## UC04: Registrar Bloqueio de Agenda

**Nome**: Registrar Bloqueio de Agenda

**Descri√ß√£o**: O sistema permite ao M√©dico ou Gestor reservar um per√≠odo na agenda do m√©dico (ex: f√©rias, treinamento) impedindo novos agendamentos naquele intervalo.

**Atores**: M√©dico, Gestor (Herda de Administrativo).

### Pr√©-condi√ß√µes

O usu√°rio deve estar autenticado.
O per√≠odo a ser bloqueado n√£o pode ter Agendamentos confirmados (status "Ativo").

### P√≥s-condi√ß√µes

√â criado um novo registro de BlocoAgenda vinculado ao M√©dico.
O hor√°rio bloqueado √© refletido na visualiza√ß√£o da agenda como indispon√≠vel para UC02.

### Fluxo B√°sico

O Ator acessa a fun√ß√£o de Gest√£o de Bloqueio de Agenda.
O usu√°rio seleciona o M√©dico e informa o intervalo de dataInicio e dataFim.
O usu√°rio preenche o motivo do bloqueio.
O Sistema verifica a exist√™ncia de Agendamentos Ativos no per√≠odo selecionado.
O usu√°rio confirma o bloqueio.
O Sistema salva o novo BlocoAgenda no AgendamentoRepository.
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 2 ‚Äì Bloqueio Recorrente: O usu√°rio define uma recorr√™ncia (ex: semanalmente) para o bloqueio, e o Sistema gera m√∫ltiplos registros de BlocoAgenda.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 4 ‚Äì Conflito com Agendamento Existente: O Sistema identifica que existem Agendamentos ativos no per√≠odo. O Sistema exibe a mensagem "Bloqueio n√£o permitido. [X] agendamentos ativos devem ser cancelados (UC09) ou reagendados primeiro." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-BLOQ.1) O motivo do bloqueio √© obrigat√≥rio.
(RN-BLOQ.2) Apenas o M√©dico ou um Gestor podem registrar um BlocoAgenda para um M√©dico.

---

## UC05: Dar Baixa em Insumos

**Nome**: Dar Baixa em Insumos

**Descri√ß√£o**: O sistema registra o consumo de um Item (Medicamento, Hospitalar) do Estoque e atualiza o saldo, garantindo que o item n√£o esteja vencido.

**Atores**: Profissional de Sa√∫de (M√©dico), Secret√°ria (Herda de Administrativo e Profissional de Sa√∫de).

### Pr√©-condi√ß√µes

O Item deve estar cadastrado no Estoque.
Deve haver quantidade dispon√≠vel e v√°lida no Estoque.

### P√≥s-condi√ß√µes

A quantidadeTotal do Item √© reduzida no Estoque.
√â gerado um registro de movimenta√ß√£o de sa√≠da no m√≥dulo de Estoque.
O Sistema verifica o Estoque Cr√≠tico (UC07). **[NOTA: UC07 N√ÉO IMPLEMENTADO - Apenas verifica√ß√£o b√°sica retorna booleano]**

### Fluxo B√°sico

O Ator acessa a funcionalidade de Baixa de Estoque.
O usu√°rio pesquisa e seleciona o Item (ex: por c√≥digo).
O Sistema informa o saldo atual e a validade mais pr√≥xima.
O usu√°rio informa a quantidadeNecessaria para a baixa e o destino do consumo (ex: Agendamento ID).
O Sistema consulta o EstoqueRepository para verificar a validade e a disponibilidade.
O Sistema atualiza a quantidadeTotal do Item no Estoque.
O Sistema dispara a verifica√ß√£o de Estoque Cr√≠tico (UC07). **[N√ÉO IMPLEMENTADO - Apenas verifica√ß√£o b√°sica]**
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 ‚Äì Baixa por Lote: O usu√°rio seleciona especificamente o lote do qual a baixa ser√° efetuada, priorizando o item de validade mais antiga.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 5 ‚Äì Item Vencido: O Sistema detecta que o lote com a menor validade est√° vencido. O Sistema exibe "Item vencido. Selecione outro lote ou proceda ao descarte (UC10)." A baixa √© negada.
(E2) Exce√ß√£o ao Passo 5 ‚Äì Estoque Insuficiente: O Sistema detecta que a quantidadeTotal √© menor que a quantidade solicitada. O Sistema exibe "Estoque insuficiente. Dispon√≠vel: [X]." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-BAIXA.1) O consumo deve ser rastre√°vel (vinculado a um procedimento, consulta, ou √°rea). **[NOTA ARQUITETURAL]** UC05 √© independente do m√≥dulo Agendamento - n√£o h√° integra√ß√£o direta entre EstoqueService e AgendamentoService.
(RN-BAIXA.2) Deve ser aplicada a regra FIFO (First-In, First-Out) ou FEFO (First-Expired, First-Out) ao selecionar o lote.

---

## UC06: Processar Entrada de NF/Itens

**Nome**: Processar Entrada de NF/Itens

**Descri√ß√£o**: O sistema registra a entrada de novos Itens no Estoque, associando-os a uma Nota Fiscal (NF), Fornecedor e Pedido.

**Atores**: Secret√°ria, Gestor (Herda de Administrativo).

### Pr√©-condi√ß√µes

O Fornecedor deve estar cadastrado.
A Nota Fiscal (NF) deve ser √∫nica no sistema.

### P√≥s-condi√ß√µes

A quantidadeTotal do Item √© incrementada.
√â gerado um registro de movimenta√ß√£o de entrada.
O status do Pedido (se existir) pode ser atualizado para "Recebido Parcialmente/Totalmente".

### Fluxo B√°sico

O Ator acessa a fun√ß√£o de Entrada de Estoque.
O usu√°rio informa o NF (N√∫mero da Nota Fiscal) e seleciona o Fornecedor.
O usu√°rio insere a lista de Itens recebidos (c√≥digo, quantidade, validade, lote).
O Sistema consulta o EstoqueService para verificar a exist√™ncia do Item e se a validade √© aceit√°vel (n√£o muito curta).
O Sistema incrementa a quantidadeTotal do Item no EstoqueRepository e registra o novo lote.
O Sistema dispara a verifica√ß√£o de Estoque Cr√≠tico (UC07). **[N√ÉO IMPLEMENTADO - Apenas verifica√ß√£o b√°sica]**
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 3 ‚Äì Entrada de Novo Item: O Item n√£o √© encontrado no cadastro. O Sistema oferece a op√ß√£o de cadastrar o novo Item antes de prosseguir com a entrada.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 4 ‚Äì Validade Curta: O Sistema detecta um Item com data de validade inferior a 30 dias. O Sistema exige confirma√ß√£o do Gestor e registra um alerta de risco.
(E2) Exce√ß√£o ao Passo 2 ‚Äì NF Duplicada: O Sistema detecta que o n√∫mero de NF j√° foi processado. O Sistema exibe "Nota Fiscal j√° registrada." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-ENTRADA.1) A rastreabilidade por lote e validade √© obrigat√≥ria para todos os Itens (RN-ESTOQUE.3).
(RN-ENTRADA.2) A entrada deve ser vinculada √† Conta a Pagar gerada pela compra (M√≥dulo Financeiro).

---

## UC07: Gerar Alerta de Estoque Cr√≠tico **[REDU√á√ÉO DE ESCOPO - N√ÉO IMPLEMENTADO]**

**Nome**: Gerar Alerta de Estoque Cr√≠tico

**Status**: ‚ö†Ô∏è **REDU√á√ÉO DE ESCOPO** - Este caso de uso foi planejado mas N√ÉO foi implementado. O backend do m√≥dulo Estoque n√£o possui subscriber Redis para processar solicita√ß√µes de alertas. Apenas verifica√ß√£o b√°sica de estoque cr√≠tico est√° implementada (retorno booleano).

**Descri√ß√£o**: O sistema verifica a quantidade de Itens no Estoque e notifica o Gestor se o saldo cair abaixo do ponto de reposi√ß√£o configurado.

**Atores**: Sistema, Gestor.

### Pr√©-condi√ß√µes

O ponto de reposi√ß√£o (estoque m√≠nimo) deve estar configurado para cada Item.
O c√°lculo √© geralmente acionado ap√≥s uma baixa (UC05) ou entrada (UC06).

### P√≥s-condi√ß√µes

√â gerado um registro de alerta no sistema.
O Gestor √© notificado (ex: notifica√ß√£o interna, email).

### Fluxo B√°sico

O Sistema (em background ou acionado por UC05/UC06) inicia a verifica√ß√£o.
O Sistema percorre todos os Itens ativos.
O Sistema compara a quantidadeTotal com o Ponto de Reposi√ß√£o configurado.
Se a quantidadeTotal < Ponto de Reposi√ß√£o, o Sistema gera o alerta e registra o evento.
O Sistema notifica o Gestor sobre o Item, a quantidade atual e a necessidade de reposi√ß√£o.
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 5 ‚Äì Sugest√£o de Pedido: O Sistema oferece um bot√£o/op√ß√£o para o Gestor gerar um rascunho de Pedido de Compra para o Item cr√≠tico.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 3 ‚Äì Ponto de Reposi√ß√£o N√£o Configurado: O Sistema lista os Itens sem configura√ß√£o, mas n√£o gera alerta para eles.

### Regras de Neg√≥cio

(RN-ALERTA.1) A notifica√ß√£o deve ser imediata ou ocorrer em intervalos definidos (ex: consolidado a cada hora). **[N√ÉO IMPLEMENTADO - Sem subscriber no m√≥dulo Estoque]**
(RN-ALERTA.2) Itens com validade pr√≥xima (UC10) tamb√©m devem ser considerados no c√°lculo de estoque cr√≠tico, mesmo que a quantidade seja alta. **[N√ÉO IMPLEMENTADO]**

**Observa√ß√£o de Implementa√ß√£o**: O m√≥dulo Cadastro possui `GerarAlertaEstoqueCriticoUseCase` e `EstoqueAlertaPublisher` que tentam solicitar alertas via Redis Pub/Sub (`estoque.alerta.request`), mas o m√≥dulo Estoque N√ÉO possui subscriber para processar essas solicita√ß√µes. Apenas a verifica√ß√£o b√°sica `verificarEstoqueCritico(itemId)` est√° implementada, retornando um booleano.

---

## UC08: Consultar Hist√≥rico do Paciente **[REDU√á√ÉO DE ESCOPO - IMPLEMENTA√á√ÉO PARCIAL]**

**Nome**: Consultar Hist√≥rico do Paciente

**Status**: ‚ö†Ô∏è **IMPLEMENTA√á√ÉO PARCIAL** - Este caso de uso est√° parcialmente implementado. O backend retorna apenas dados do m√≥dulo Agendamento (consultas, exames, procedimentos). Os seguintes m√≥dulos N√ÉO possuem subscribers Redis:
- **Estoque**: N√ÉO responde a `historico.estoque.request` (itensBaixados sempre vazio)
- **Financeiro**: N√ÉO responde a `historico.pagamento.request` (pagamentos sempre vazio)

**Descri√ß√£o**: O sistema permite a consulta consolidada do cadastro, agendamentos passados/futuros e procedimentos/exames realizados para um paciente.

**Atores**: Secret√°ria, Profissional de Sa√∫de (M√©dico).

### Pr√©-condi√ß√µes

O Paciente deve estar cadastrado.
O Ator deve ter permiss√£o de acesso ao n√≠vel de detalhe desejado (ex: M√©dico pode ver dados cl√≠nicos, Secret√°ria pode ver apenas agendamentos).

### P√≥s-condi√ß√µes

O Ator visualiza o hist√≥rico consolidado.

### Fluxo B√°sico

O Ator acessa a fun√ß√£o de Consulta de Pacientes.
O usu√°rio pesquisa o Paciente (por CPF, Nome ou ID).
O Sistema exibe os dados cadastrais (Pessoa, Paciente, Conv√™nio).
O Sistema consolida a lista de Agendamentos (passados e futuros).
O Sistema exibe os resultados de Procedimento, Exame e os insumos baixados (UC05) vinculados aos Agendamentos realizados. **[IMPLEMENTA√á√ÉO PARCIAL: Apenas Agendamento responde. Estoque e Financeiro n√£o implementaram subscribers]**
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 5 ‚Äì Filtro de Documentos: O usu√°rio pode filtrar o hist√≥rico para exibir apenas Exames ou apenas Agendamentos de um tipo espec√≠fico.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 2 ‚Äì Paciente N√£o Encontrado: O Sistema exibe "Nenhum paciente encontrado com os crit√©rios de busca." O caso de uso √© encerrado.
(E2) Exce√ß√£o ao Passo 5 ‚Äì Permiss√£o Negada: Se a Secret√°ria tentar acessar dados cl√≠nicos, o Sistema exibe "Acesso restrito. Conte√∫do confidencial." e oculta o detalhe cl√≠nico.

### Regras de Neg√≥cio

(RN-HIST.1) **[REDU√á√ÉO DE ESCOPO]** A consulta retorna dados apenas do m√≥dulo Agendamento (consultas do paciente). Integra√ß√£o com outros m√≥dulos (Estoque, Financeiro) n√£o est√° implementada.
(RN-HIST.2) O acesso a dados sens√≠veis √© determinado pela PerfilUsuario do Ator.

---

## UC09: Cancelar Agendamento

**Nome**: Cancelar Agendamento

**Descri√ß√£o**: O sistema altera o status de um Agendamento ativo para "Cancelado", liberando o hor√°rio na agenda do M√©dico e registrando o motivo.

**Atores**: Secret√°ria, M√©dico, Gestor (Herda de Administrativo).

### Pr√©-condi√ß√µes

O Agendamento deve estar ativo e agendado para o futuro.

### P√≥s-condi√ß√µes

O status do Agendamento √© alterado para "Cancelado".
O hor√°rio na agenda do M√©dico √© liberado para um novo UC02.
√â registrado um motivo de cancelamento.

### Fluxo B√°sico

O Ator acessa o Agendamento a ser cancelado (via UC08 ou agenda).
O usu√°rio seleciona a op√ß√£o "Cancelar Agendamento".
O usu√°rio informa o motivo do cancelamento.
O Sistema verifica a anteced√™ncia do cancelamento (RN-AGENDA.3).
O Sistema exibe uma confirma√ß√£o de seguran√ßa.
O Sistema atualiza o status do Agendamento para "Cancelado".
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 4 ‚Äì Reagendamento: O usu√°rio pode optar por "Cancelar e Reagendar" em uma √∫nica transa√ß√£o (inicia o fluxo do UC02).

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 4 ‚Äì Agendamento Pr√≥ximo: Se o cancelamento ocorrer fora do prazo (ex: 15 minutos antes), o Sistema registra o evento como "Cancelamento Tarde" para fins estat√≠sticos e pode aplicar uma penalidade (M√≥dulo Financeiro).
(E2) Exce√ß√£o ao Passo 1 ‚Äì Agendamento J√° Realizado: O Sistema detecta que o Agendamento j√° foi baixado como "Realizado". O Sistema exibe "N√£o √© poss√≠vel cancelar um agendamento j√° realizado." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-AGENDA.3) Agendamentos cancelados devem registrar se o cancelamento foi dentro ou fora do prazo.
(RN-AGENDA.4) O Agendamento s√≥ pode ser cancelado se o status n√£o for "Realizado" ou "N√£o Compareceu".

---

## UC10: Controlar Validade de Itens **[REDU√á√ÉO DE ESCOPO - IMPLEMENTA√á√ÉO PARCIAL]**

**Nome**: Controlar Validade de Itens

> **Status de Implementa√ß√£o**: UC10 est√° **parcialmente implementado**. A funcionalidade de consulta de itens por validade e descarte via endpoint REST est√° operacional. Por√©m, a persist√™ncia de movimenta√ß√µes de descarte em banco de dados n√£o foi implementada (apenas logs no console). N√£o h√° integra√ß√£o com M√≥dulo Financeiro (inexistente) nem alertas autom√°ticos via Redis Pub/Sub.

**Descri√ß√£o**: O sistema identifica Itens no Estoque cuja validade est√° pr√≥xima ou expirada e permite sua separa√ß√£o e baixa para descarte.

**Atores**: Gestor (Herda de Administrativo), Sistema.

### Pr√©-condi√ß√µes

Os Itens devem ter a data de validade e lote registrados.
Regras de descarte e anteced√™ncia para alerta devem estar configuradas.

### P√≥s-condi√ß√µes

√â gerado um relat√≥rio ou lista de itens vencidos/pr√≥ximos.
O saldo de Itens descartados √© deduzido da quantidadeTotal do Estoque (Baixa por Descarte).

### Fluxo B√°sico

O Gestor acessa a fun√ß√£o de Controle de Validade.
O usu√°rio informa o crit√©rio de busca (ex: Vence nos Pr√≥ximos 30 dias ou Vencidos).
O Sistema busca todos os Itens no Estoque (via EstoqueRepository) que atendem ao crit√©rio.
O Sistema exibe a lista, detalhando o nome, validade, lote e quantidade.
O Gestor seleciona os Itens que ser√£o descartados e confirma a a√ß√£o.
O Sistema registra a sa√≠da por descarte e atualiza o saldo do Estoque (analogia ao UC05, mas com tipo de movimenta√ß√£o "Descarte").
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 1 ‚Äì Verifica√ß√£o Autom√°tica: O Sistema executa a verifica√ß√£o (igual ao UC07, mas focada em validade) periodicamente e envia um relat√≥rio ao Gestor.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 3 ‚Äì Nenhum Item Encontrado: O Sistema exibe "Nenhum item encontrado no crit√©rio de validade." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-ESTOQUE.3) Itens vencidos (validade < data atual) devem ser removidos do saldo dispon√≠vel para Baixa de Insumos (UC05).
(RN-ESTOQUE.4) A baixa por descarte deve ser registrada com um c√≥digo de custo (M√≥dulo Financeiro). **[IMPLEMENTA√á√ÉO PARCIAL]** - O c√≥digo de custo √© validado no DTO, mas a movimenta√ß√£o n√£o √© persistida em banco de dados (apenas log no console). M√≥dulo Financeiro n√£o existe.

---

## UC11: Gerenciar Usu√°rios e Perfis de Acesso

**Nome**: Gerenciar Usu√°rios e Perfis de Acesso DESCRI√á√ÉO SUCINTA: O sistema permite a cria√ß√£o, modifica√ß√£o e desativa√ß√£o de contas de usu√°rios (M√©dico, Secret√°ria, Gestor), atribuindo o perfil de acesso e permiss√µes espec√≠ficas. ATORES: Gestor (Herda de Administrativo).

### Pr√©-condi√ß√µes

O Gestor deve estar autenticado.
Os perfis de acesso (PerfilUsuario) devem estar configurados no sistema.

### P√≥s-condi√ß√µes

√â criado/atualizado um registro de Usuario e Pessoa. Se o usu√°rio for um M√©dico, √© criado tamb√©m um registro separado de Medico (entidades independentes, ambas herdando de Pessoa).
O PerfilUsuario e as permiss√µes s√£o definidos.

### Fluxo B√°sico

O Gestor acessa a funcionalidade de Gest√£o de Usu√°rios.
O usu√°rio seleciona a op√ß√£o "Cadastrar Novo Usu√°rio" ou "Buscar/Editar Usu√°rio Existente".
O usu√°rio preenche os dados da Pessoa (Nome, Telefone, Email) e do Usuario (Login e Senha).
O usu√°rio seleciona o PerfilUsuario (M√©dico, Secret√°ria, Gestor).
Se o Perfil for M√©dico: O usu√°rio preenche os dados espec√≠ficos (CRM, Especialidade).
O usu√°rio define as permiss√µes adicionais (ex: temPermissaoEncaixe()).
O Sistema valida a unicidade do Login e do CRM (se aplic√°vel).
O usu√°rio confirma o cadastro/atualiza√ß√£o.
O Sistema salva os registros nos m√≥dulos de Cadastro.
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 2 ‚Äì Desativa√ß√£o de Usu√°rio: O usu√°rio busca um usu√°rio e altera seu status para "Inativo" em vez de exclu√≠-lo, preservando o hist√≥rico de a√ß√µes.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 7 ‚Äì Login Duplicado: O Sistema detecta que o Login ou o CRM (se M√©dico) j√° est√£o em uso. O Sistema exibe a mensagem "Login/CRM j√° cadastrado." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-USER.1) A senha deve atender a crit√©rios de seguran√ßa (ex: tamanho m√≠nimo, caracteres especiais). (RN-USER.2) Apenas o Gestor pode criar ou editar o perfil de outro Gestor.

---

## UC12: Gerenciar Cadastros Base do Sistema

**Nome**: Gerenciar Cadastros Base do Sistema

**Descri√ß√£o**: O sistema permite a manuten√ß√£o dos cadastros de entidades prim√°rias necess√°rias para os outros m√≥dulos: Convenios, Itens (Medicamentos/Hospitalares) e Fornecedores.

**Atores**: Secret√°ria, Gestor.

### Pr√©-condi√ß√µes

O usu√°rio deve estar autenticado.

### P√≥s-condi√ß√µes

√â criado/atualizado um registro nas classes Convenio, Item (ou suas subclasses) ou Fornecedor.

### Fluxo B√°sico

O Ator acessa a funcionalidade de Gest√£o de Cadastros Base.
O usu√°rio seleciona o tipo de cadastro a ser gerenciado (Conv√™nio, Item ou Fornecedor).
O usu√°rio seleciona "Novo Cadastro" ou "Editar Existente".
O usu√°rio preenche os dados espec√≠ficos da entidade (ex: CNPJ para Fornecedor, nome e plano para Conv√™nio, nome e tipo para Item).
O Sistema valida a unicidade dos campos chave (CNPJ, nome do Conv√™nio, c√≥digo do Item).
O usu√°rio confirma o cadastro/atualiza√ß√£o.
O Sistema salva o registro no m√≥dulo correspondente.
O caso de uso √© encerrado.

### Fluxos Alternativos

(A1) Alternativa ao Passo 3 ‚Äì Importa√ß√£o em Massa: O usu√°rio opta por importar uma lista de itens de uma planilha, e o Sistema processa e valida os dados antes de salvar.

### Fluxos de Exce√ß√£o

(E1) Exce√ß√£o ao Passo 5 ‚Äì CNPJ/C√≥digo Duplicado: O Sistema detecta que o campo de unicidade j√° est√° registrado. O Sistema exibe a mensagem "Cadastro duplicado. Verifique o registro existente." O caso de uso √© encerrado.

### Regras de Neg√≥cio

(RN-BASE.1) O CNPJ do Fornecedor √© obrigat√≥rio e √∫nico. (RN-BASE.2) Itens devem ser categorizados corretamente (Medicamento, Hospitalar, etc.) para fins de rastreabilidade e controle de validade (RN-ESTOQUE.3). (RN-BASE.3) Um Conv√™nio inativo n√£o pode ser selecionado em novos Agendamentos (UC02).

---

