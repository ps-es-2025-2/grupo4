# Diagrama de Classes de An√°lise

> **‚ö†Ô∏è NOTA T√âCNICA - Discrep√¢ncia 3.1 Resolvida:**
> 
> **Padr√£o Implementado**: O sistema utiliza **Spring Data Repository Pattern** (JpaRepository, MongoRepository, CassandraRepository), n√£o DAO tradicional.
> 
> **Justificativa**: Spring Data abstrai opera√ß√µes CRUD e queries, reduzindo c√≥digo boilerplate e aumentando produtividade.
> 
> **Nomenclatura nos diagramas**: Para fins de an√°lise conceitual, as interfaces s√£o representadas como "Repository" alinhado com a implementa√ß√£o real.
> 
> Data da corre√ß√£o: 14/12/2025

> **‚ö†Ô∏è NOTA T√âCNICA - Discrep√¢ncia 3.2 Resolvida:**
> 
> **Arquitetura em Camadas**: O sistema implementa **Service Layer + UseCase Pattern** combinados:
> - **Services** (13 classes): L√≥gica de neg√≥cio b√°sica e opera√ß√µes CRUD (ex: `PacienteService`, `MedicoService`)
> - **UseCases** (47 classes): Casos de uso espec√≠ficos que orquestram m√∫ltiplos Services (ex: `CadastrarNovoPacienteUseCase`, `AgendarConsultaUseCase`)
> 
> **Justificativa**: Separa√ß√£o de responsabilidades clara - Services encapsulam l√≥gica de entidade √∫nica, UseCases coordenam processos complexos envolvendo m√∫ltiplas entidades.
> 
> **Nomenclatura nos diagramas**: Classes de servi√ßo s√£o representadas como `<<Service>>` para simplifica√ß√£o conceitual, mas na implementa√ß√£o h√° distin√ß√£o entre Service e UseCase.
> 
> Data da corre√ß√£o: 14/12/2025

> **‚ö†Ô∏è NOTA T√âCNICA - Discrep√¢ncia 1.1 Resolvida:**
> 
> **Discrep√¢ncia Identificada:** A documenta√ß√£o anterior mostrava `Medico extends Usuario`, mas a implementa√ß√£o real no backend possui `Medico extends Pessoa` e `Usuario extends Pessoa` como classes independentes.
> 
> **An√°lise de Impactos:**
> - Mudan√ßa para `Medico extends Usuario` teria **ALTO IMPACTO**
> - Requereria refatora√ß√£o completa: repositories, services, DTOs, controllers, testes
> - Altera√ß√£o no modelo de dados PostgreSQL (heran√ßa de tabelas)
> - Todo M√©dico precisaria obrigatoriamente de login/senha
> - Risco de quebra de integra√ß√£o com m√≥dulo de Agendamento
> 
> **Decis√£o:** Manter arquitetura atual do backend (Medico e Usuario s√£o classes irm√£s, ambas herdando de Pessoa). Documenta√ß√£o corrigida para refletir implementa√ß√£o real.
> 
> Data da corre√ß√£o: 14/12/2025

> **‚ö†Ô∏è NOTA T√âCNICA - Discrep√¢ncia 1.4 Resolvida:**
> 
> **Discrep√¢ncia Identificada:** A documenta√ß√£o mostrava atributos simplificados da classe `Agendamento`, mas a implementa√ß√£o possui atributos mais completos.
> 
> **Implementa√ß√£o Real (Melhorada):**
> - ‚úÖ Timestamps separados: agendamento, previs√£o e execu√ß√£o real
> - ‚úÖ Rastreabilidade: usu√°rios que criaram, cancelaram, iniciaram e finalizaram
> - ‚úÖ Melhor controle de ciclo de vida e auditoria
> 
> **Decis√£o:** Documenta√ß√£o atualizada para refletir implementa√ß√£o superior.
> 
> Data da corre√ß√£o: 14/12/2025

> **‚ö†Ô∏è NOTA T√âCNICA - Discrep√¢ncia 1.5 Resolvida:**
> 
> **Discrep√¢ncia Identificada:** A documenta√ß√£o n√£o mostrava os campos de rastreamento (pacienteCpf, medicoCrm, convenioNome, usuarioCriadorLogin, usuarioCanceladorLogin, usuarioIniciouServicoLogin, usuarioFinalizouServicoLogin) na classe `Agendamento`.
> 
> **Implementa√ß√£o Real (Completa):**
> - ‚úÖ Rastreamento de entidades: pacienteCpf, medicoCrm, convenioNome (refer√™ncias FK a outros microsservi√ßos)
> - ‚úÖ Rastreamento de a√ß√µes: usuarioCriadorLogin, usuarioCanceladorLogin, usuarioIniciouServicoLogin, usuarioFinalizouServicoLogin
> - ‚úÖ Auditoria completa do ciclo de vida do agendamento
> 
> **Decis√£o:** Documenta√ß√£o atualizada para incluir todos os campos de rastreamento implementados.
> 
> Data da corre√ß√£o: 14/12/2025

> **‚ö†Ô∏è NOTA T√âCNICA - Discrep√¢ncia 1.7 Resolvida:**
> 
> **Discrep√¢ncia Identificada:** A documenta√ß√£o mostrava relacionamento `Item "*" --> "1" Estoque`, mas a implementa√ß√£o Cassandra **N√ÉO possui este relacionamento**.
> 
> **An√°lise de Impacto:**
> - **Cassandra √© NoSQL:** N√£o suporta joins nativos, relacionamentos complexos n√£o s√£o recomendados
> - **MVP opera com estoque √∫nico:** Todos os casos de uso funcionam sem estoqueId
> - **Custo de implementa√ß√£o:** ALTO (80-100 horas) - refatora√ß√£o completa de schema, repositories, services, DTOs, testes
> - **Benef√≠cio para MVP:** ZERO - nenhum caso de uso implementado requer m√∫ltiplos estoques
> 
> **Decis√£o de Design NoSQL:**
> - ‚ùå Relacionamento removido da documenta√ß√£o
> - ‚úÖ Sistema opera com estoque √∫nico impl√≠cito (adequado para MVP)
> - ‚ö†Ô∏è Poss√≠vel expans√£o futura se necess√°rio (m√∫ltiplos estoques f√≠sicos)
> 
> **Justificativa:** Cassandra favorece desnormaliza√ß√£o. Se m√∫ltiplos estoques forem necess√°rios no futuro, implementar como partition key (`estoqueId`) em `Item` para performance.
> 
> Data da corre√ß√£o: 14/12/2025

## Sum√°rio

- [Notas T√©cnicas - Corre√ß√µes de Discrep√¢ncias](#notas-t√©cnicas---corre√ß√µes-de-discrep√¢ncias)
- [1. Diagrama Modular - Vis√£o Simplificada](#1-diagrama-modular---vis√£o-simplificada)
  - [C√≥digo PlantUML](#c√≥digo-plantuml-1)
  - [Diagrama Visual](#diagrama-visual-1)
- [2. Diagrama Completo - Todos os M√≥dulos](#2-diagrama-completo---todos-os-m√≥dulos)
  - [C√≥digo PlantUML](#c√≥digo-plantuml-2)
  - [Diagrama Visual](#diagrama-visual-2)
- [3. M√≥dulo de Cadastro](#3-m√≥dulo-de-cadastro)
  - [C√≥digo PlantUML](#c√≥digo-plantuml-3)
  - [Diagrama Visual](#diagrama-visual-3)
- [4. M√≥dulo de Agendamento](#4-m√≥dulo-de-agendamento)
  - [C√≥digo PlantUML](#c√≥digo-plantuml-4)
  - [Diagrama Visual](#diagrama-visual-4)
- [5. M√≥dulo de Estoque](#5-m√≥dulo-de-estoque)
  - [C√≥digo PlantUML](#c√≥digo-plantuml-5)

---

## Notas T√©cnicas - Corre√ß√µes de Discrep√¢ncias

Este documento foi extensivamente atualizado para corrigir m√∫ltiplas discrep√¢ncias entre documenta√ß√£o e implementa√ß√£o. Notas t√©cnicas detalhadas aparecem inline no in√≠cio do documento.

### Discrep√¢ncia 1.1: M√≥dulo Cadastro - Hierarquia M√©dico vs Usuario

**Discrep√¢ncia:** Documenta√ß√£o mostrava `Medico extends Usuario`, mas backend tem `Medico extends Pessoa` e `Usuario extends Pessoa` (classes irm√£s).

**Mudan√ßa Feita:** Diagrama UML corrigido para mostrar heran√ßa correta de Pessoa. Mantida arquitetura backend por ter ALTO IMPACTO de mudan√ßa.

**Justificativa:** Refatora√ß√£o completa custaria 60-80 horas e quebraria integra√ß√£o com Agendamento. Decis√£o: documentar implementa√ß√£o real.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_1.1.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_1.1.md)

### Discrep√¢ncia 1.4: M√≥dulo Agendamento - Atributos Divergentes

**Discrep√¢ncia:** Documenta√ß√£o tinha atributos simplificados, implementa√ß√£o tem timestamps e rastreabilidade completa.

**Mudan√ßa Feita:** Diagrama atualizado com timestamps separados (agendamento, previs√£o, execu√ß√£o) e campos de rastreamento de usu√°rios.

**Justificativa:** Implementa√ß√£o √© SUPERIOR ao planejamento inicial - melhor auditoria e controle de ciclo de vida.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_1.4.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_1.4.md)

### Discrep√¢ncia 1.5: M√≥dulo Agendamento - Atributos Extras de Rastreamento

**Discrep√¢ncia:** Documenta√ß√£o n√£o mostrava campos pacienteCpf, medicoCrm, convenioNome, usuarioCriadorLogin, etc.

**Mudan√ßa Feita:** Todos os campos de rastreamento adicionados ao diagrama de classes (7 campos de auditoria).

**Justificativa:** Implementa√ß√£o backend tem rastreamento completo de entidades FK e a√ß√µes de usu√°rios.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_1.5.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_1.5.md)

### Discrep√¢ncia 1.7: M√≥dulo Estoque - Relacionamento Item ‚Üî Estoque Faltante

**Discrep√¢ncia:** Documenta√ß√£o mostrava `Item "*" --> "1" Estoque`, mas Cassandra n√£o possui este relacionamento.

**Mudan√ßa Feita:** Relacionamento removido do diagrama. Sistema opera com estoque √∫nico impl√≠cito.

**Justificativa:** Cassandra NoSQL n√£o suporta joins. MVP n√£o requer m√∫ltiplos estoques. Custo de implementa√ß√£o: 80-100 horas com benef√≠cio ZERO.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_1.7.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_1.7.md)

### Discrep√¢ncia 3.1: Padr√£o DAO vs Repository (Spring Data)

**Discrep√¢ncia:** Documenta√ß√£o usava termo "DAO", mas implementa√ß√£o usa Spring Data Repository Pattern.

**Mudan√ßa Feita:** Nomenclatura nos diagramas alterada para "Repository" (JpaRepository, MongoRepository, CassandraRepository).

**Justificativa:** Spring Data abstrai CRUD, reduz boilerplate. Implementa√ß√£o usa padr√£o moderno.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_3.1.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_3.1.md)

### Discrep√¢ncia 3.2: Camada de Servi√ßo - Service vs UseCase

**Discrep√¢ncia:** Documenta√ß√£o n√£o distinguia Services (13 classes) de UseCases (47 classes).

**Mudan√ßa Feita:** Documentado que sistema usa Service Layer + UseCase Pattern combinados. Services para l√≥gica de entidade √∫nica, UseCases para orquestra√ß√£o complexa.

**Justificativa:** Arquitetura backend tem separa√ß√£o clara: Services encapsulam CRUD, UseCases coordenam processos.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_3.2.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_3.2.md)

### Discrep√¢ncia 3.3: Integra√ß√£o AgendamentoService ‚Üí CadastroService

**Discrep√¢ncia:** Documenta√ß√£o mostrava depend√™ncias diretas entre servi√ßos de m√≥dulos diferentes.

**Mudan√ßa Feita:** Removidas depend√™ncias diretas do diagrama. Documentado uso de Redis Pub/Sub e strings identificadoras (pacienteCpf, medicoCrm).

**Justificativa:** Backend tem zero imports entre m√≥dulos. Arquitetura de microservi√ßos com Database per Service.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_3.3.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_3.3.md)

### Discrep√¢ncia 3.4: Integra√ß√£o AgendamentoService ‚Üí EstoqueService (Baixa em Insumos)

**Discrep√¢ncia:** Documenta√ß√£o mostrava AgendamentoService com atributo estoqueService e m√©todo darBaixaEmMateriais().

**Mudan√ßa Feita:** Removidos estoqueService e darBaixaEmMateriais() de AgendamentoService. UC05 √© independente no m√≥dulo Estoque.

**Justificativa:** DarBaixaInsumosUseCase existe SOMENTE no m√≥dulo Estoque sem integra√ß√£o com Agendamento.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_3.4.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_3.4.md)

### Discrep√¢ncia 4.1: Paciente ‚Üî Conv√™nio (Cardinalidade Errada)

**Discrep√¢ncia:** Documenta√ß√£o mostrava `Paciente "1" -- "0..*" Convenio`, mas backend tem @ManyToOne (correto: `"0..*" -- "0..1"`).

**Mudan√ßa Feita:** Cardinalidade corrigida no diagrama UML para Many-to-One (muitos pacientes para zero ou um conv√™nio).

**Justificativa:** Backend tem FK nullable convenio_id em Paciente. Cardinalidade estava invertida (lida de tr√°s para frente).

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_4.1.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_4.1.md)

### Discrep√¢ncia 4.2: M√©dico ‚Üî Conv√™nio (Relacionamento Faltante)

**Discrep√¢ncia:** Documenta√ß√£o mostrava Many-to-Many entre Medico e Convenio (credenciamento), mas backend N√ÉO possui este relacionamento.

**Mudan√ßa Feita:** Relacionamento Many-to-Many removido do diagrama (2 ocorr√™ncias). Valida√ß√£o √© manual pela secret√°ria.

**Justificativa:** Backend n√£o tem @ManyToMany nem collections. Feature de credenciamento n√£o foi implementada (redu√ß√£o de escopo).

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_4.2.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_4.2.md)

### Discrep√¢ncia 4.3: Usuario ‚Üî PerfilUsuario (Enum Incompleto)

**Discrep√¢ncia:** Documenta√ß√£o tinha enum com 3-4 valores, backend tem 5 (MEDICO, SECRETARIA, GESTOR, FINANCEIRO, TESOURARIA).

**Mudan√ßa Feita:** Adicionados FINANCEIRO e TESOURARIA ao enum EPerfilUsuario no diagrama (2 ocorr√™ncias).

**Justificativa:** EPerfilUsuario.java tem 5 valores. Documenta√ß√£o desatualizada quando perfis financeiros foram adicionados.

**Documento Detalhado:** [üìÑ CORRECAO_DISCREPANCIA_4.3.md](../../Corre√ß√µes%20de%20Alinhamento/CORRECAO_DISCREPANCIA_4.3.md)

---

Para consultar todas as corre√ß√µes de discrep√¢ncias do projeto, acesse o [üìë Sum√°rio de Corre√ß√µes](../../Corre√ß√µes%20de%20Alinhamento/SUMARIO_CORRECAO_DISCREPANCIA.md).
  - [Diagrama Visual](#diagrama-visual-5)

---

## 1. Diagrama Modular - Vis√£o Simplificada

Este diagrama apresenta a estrutura modular b√°sica do sistema, mostrando a integra√ß√£o entre os tr√™s m√≥dulos principais: Cadastro, Agendamento e Estoque.

### C√≥digo PlantUML

```plantuml
@startuml

\' \-\-- Estilos \-\--

skinparam package {

BackgroundColor Azure

BorderColor DarkSlateGray

}

skinparam class {

ArrowColor #8B0000

BorderColor DarkSlateGray

}

interface Style {

BackgroundColor LightCoral

BorderColor Red

}

\' ===============================================

\' PACOTE 1: CADASTRO CORE (DADOS BASE)

\' ===============================================

package \"1. M√≥dulo Cadastro (Core)\" {

class Paciente \<\<Entity\>\> {

\+ cpf : String {unique}

\+ dataNascimento : Date

\+ verificarExistencia()

}

interface PacienteRepository \<\<Repository\>\> {

\+ save(p: Paciente) : Paciente

\+ findByCpf(cpf: String) : Optional\<Paciente\>

\+ existsByCpf(cpf: String) : Boolean

}

class CadastroService \<\<Service\>\> {

\- pacienteRepository : PacienteRepository

\- medicoRepository : MedicoRepository

\--

\+ registrarNovoPaciente(p: Paciente)

\+ verificarDisponibilidadeCrm(crm: String) : Boolean

}

PacienteRepository \<\|.. PacienteRepositoryImpl

CadastroService o\--\> PacienteRepository : usa

}

\' ===============================================

\' PACOTE 2: AGENDAMENTO (INTEGRA√á√ÉO COM CADASTRO)

\' ===============================================

package \"2. M√≥dulo Agendamento\" {

class Agendamento \<\<Entity\>\> {

\+ id : Integer

\+ dataHoraInicio : DateTime

\+ motivoEncaixe : String \[Opcional\]

\+ pacienteCpf : String

\+ medicoCrm : String

\+ convenioNome : String

\+ usuarioCriadorLogin : String

\--

\+ isEncaixe() : Boolean

}

interface AgendamentoRepository \<\<Repository\>\> {

\+ save(a: Agendamento) : Agendamento

\+ findByMedicoCrmAndDataHoraInicioPrevistaBetween(crm: String, inicio: LocalDateTime, fim: LocalDateTime) : List\<Agendamento\>

}

class AgendamentoService \<\<Service\>\> {

\- agendamentoRepository : AgendamentoRepository

\' NOTA: Integra√ß√£o com Cadastro/Estoque via Redis Pub/Sub

\--

\+ criarAgendamento(a: Agendamento)

\+ cancelarConsulta(agendamentoId: Long)

\+ verificaDisponibilidade(medicoId, dtInicio, dtFim) : Boolean

\' REDU√á√ÉO DE ESCOPO: Baixa em insumos √© feita pelo m√≥dulo Estoque (UC05)

}

' Spring Data gera implementa√ß√£o automaticamente (MongoRepository)

AgendamentoService o\--\> AgendamentoRepository : usa

' NOTA ARQUITETURAL: N√ÉO h√° depend√™ncia direta entre m√≥dulos
' Agendamento armazena pacienteCpf e medicoCrm como Strings
' Integra√ß√£o com Cadastro √© via Redis Pub/Sub (desacoplada)

}

\' ===============================================

\' PACOTE 3: ESTOQUE (INTEGRA√á√ÉO COM SUPRIMENTOS)

\' ===============================================

package \"3. M√≥dulo Estoque e Suprimentos\" {

class Item \<\<Entity\>\> {

\+ id_item : long

\+ nome : String

\+ quantidadeTotal : int

\+ validade : Date

}

interface EstoqueRepository \<\<Repository\>\> {

\+ save(estoque: Estoque) : Estoque

\+ findById(id: UUID) : Optional\<Estoque\>

}

interface ItemRepository \<\<Repository\>\> {

\+ save(item: Item) : Item

\+ findAll() : List\<Item\>

}

class EstoqueService \<\<Service\>\> {

\- estoqueRepository : EstoqueRepository

\- itemRepository : ItemRepository

\--

\+ verificarEstoqueCritico(itemId: Long)

\+ processarEntradaNF(nf: String)

\+ solicitarReposicao(itemId: Long)

}

EstoqueRepository \<\|.. EstoqueRepositoryImpl

EstoqueService o\--\> EstoqueRepository : usa

\' Rela√ß√£o da entidade Agendamento com a entidade Item (uso de
suprimentos)

\' NOTA: Integra√ß√£o entre m√≥dulos √© via Redis Pub/Sub (desacoplada)
\' N√ÉO h√° chamadas diretas entre AgendamentoService e EstoqueService

}

@enduml
```

### Diagrama Visual

![Diagrama Modular](images/image3.png)

---

## 2. Diagrama Completo - Todos os M√≥dulos

Este diagrama integra todos os m√≥dulos do sistema, mostrando as rela√ß√µes completas entre as classes de Cadastro, Agendamento e Estoque.

### C√≥digo PlantUML

```plantuml
@startuml

\' \-\-- Estilos Globais \-\--

skinparam package {

BackgroundColor PaleGreen

BorderColor DarkGreen

FontColor DarkGreen

}

skinparam class {

BackgroundColor LightYellow

BorderColor DarkGreen

ArrowColor #2F4F4F

}

skinparam interface {

BackgroundColor LightBlue

BorderColor DarkBlue

FontStyle Bold

}

hide empty members

\' ===============================================

\' PACOTE 1: M√ìDULO DE CADASTRO (CORE)

\' ===============================================

package \"1. M√≥dulo Cadastro (Core)\" {

class Pessoa \<\<Abstract\>\> {

\+ nomeCompleto : String

\+ telefone : String

\+ email : String

}

class Paciente extends Pessoa {

\+ dataNascimento : Date

\+ cpf : String {unique}

\+ verificarExistencia()

}

class Usuario extends Pessoa {

\+ login : String {unique}

\+ senha : String

\+ temPermissaoEncaixe() : Boolean

}

class Medico extends Pessoa {

\+ crm : String {unique}

\+ especialidade : String

}

class Convenio {

\+ nome : String

\+ plano : String

\+ ativo : Boolean

}

enum PerfilUsuario \<\<Enum\>\> {

MEDICO

SECRETARIA

GESTOR

FINANCEIRO

TESOURARIA

}

\' Camada de Persist√™ncia

interface PacienteRepository \<\<Repository\>\> {

\+ salvar(p: Paciente)

\+ buscarPorCpf(cpf: String) : Paciente

}

interface MedicoRepository \<\<Repository\>\> {

\+ buscarPorCrm(crm: String) : Medico

}

\' Camada de Servi√ßo (Integra√ß√£o/Neg√≥cio)

class CadastroService \<\<Service\>\> {

\- pacienteRepository : PacienteRepository

\- medicoRepository : MedicoRepository

\--

\+ registrarNovoPaciente(p: Paciente)

\+ buscarMedicoPorCrm(crm: String) : Medico

}

\' Implementa√ß√µes e Depend√™ncias Internas

PacienteRepository \<\|.. PacienteRepositoryImpl

MedicoRepository \<\|.. MedicoRepositoryImpl

CadastroService o\--\> PacienteRepository : usa

CadastroService o\--\> MedicoRepository : usa

Usuario \"1\" \-- \"1\" PerfilUsuario : tem

' M√©dico N√ÉO possui atributo ou anota√ß√£o @ManyToMany com Conv√™nio
' REDU√á√ÉO DE ESCOPO 4.2: Relacionamento M√©dico-Conv√™nio n√£o implementado


' CORRE√á√ÉO CARDINALIDADE 4.1: Um Paciente \"0..*\" -- \"0..1\" Convenio : possui plano


}

\' ===============================================

\' PACOTE 2: M√ìDULO DE AGENDAMENTO

\' ===============================================

package \"2. M√≥dulo Agendamento\" {

class Agendamento {

\+ id : Integer

\+ dataHoraAgendamento : DateTime

\+ dataHoraInicioPrevista : DateTime

\+ dataHoraFimPrevista : DateTime

\+ dataHoraInicioExecucao : DateTime

\+ dataHoraFimExecucao : DateTime

\+ isEncaixe : Boolean

\+ modalidade : ModalidadeEnum

\+ motivoEncaixe : String \[Opcional\]

\+ observacoes : String

\+ status : StatusAgendamentoEnum

\+ motivoCancelamento : String

\+ dataCancelamento : DateTime

\+ pacienteCpf : String

\+ medicoCrm : String

\+ convenioNome : String

\+ usuarioCriadorLogin : String

\+ usuarioCanceladorLogin : String

\+ usuarioIniciouServicoLogin : String

\+ usuarioFinalizouServicoLogin : String

}

class Consulta extends Agendamento {

\+ especialidade : String

\+ tipoConsulta : Enum{primeira, retorno, rotina}

}

class Procedimento {

\+ descricaoProcedimento : String

\+ salaEquipamentoNecessario : String \[Opcional\]

\+ nivelRisco : String

}

class Exame {

\+ nomeExame : String

\+ requerPreparo : Boolean

\+ instrucoesPreparo : String \[Opcional\]

}

class BlocoAgenda {

\+ dataInicio : DateTime

\+ dataFim : DateTime

\+ motivo : String

\+ antecedenciaMinima : Integer {dias}

}

\' Camada de Persist√™ncia

interface AgendamentoRepository \<\<Repository\>\> {

\+ persistir(a: Agendamento)

\+ buscarPorPeriodo(data: Date) : List\<Agendamento\>

}


\' NOTA: Integra√ß√£o com Cadastro/Estoque via Redis Pub/Sub (desacoplado)
\' Camada de Servi√ßo (Integra√ß√£o/Neg√≥cio)

class AgendamentoService \<\<Service\>\> {

\- agendamentoRepository : AgendamentoRepository



\' REDU√á√ÉO DE ESCOPO: Baixa em insumos n√£o √© feita pelo Agendamento

\--

\+ criarAgendamento(a: Agendamento)

\+ verificaDisponibilidade(medicoId, dtInicio, dtFim) : Boolean


}

\' Implementa√ß√µes e Depend√™ncias Internas

AgendamentoRepository \<\|.. AgendamentoRepositoryImpl

AgendamentoService o\--\> AgendamentoRepository : usa

\' Rela√ß√µes de Dom√≠nio

Paciente \"1\" \-- \"0..\*\" Agendamento : paciente_em

Medico \"1\" \-- \"0..\*\" Agendamento : agenda_para

Convenio \"1\" \-- \"0..\*\" Agendamento : cobre_por

Usuario \"1\" \-- \"0..\*\" Agendamento : criado_por

Medico \"1\" \-- \"0..\*\" BlocoAgenda : registra

Procedimento \"0..\*\" \-- \"1\" Consulta : √© realizado em

Exame \"0..\*\" \-- \"1\" Consulta : √© solicitado em

Agendamento \"\*\" \-- \"\*\" ProcedimentoItem : requer

}

\' ===============================================

\' PACOTE 3: M√ìDULO DE ESTOQUE E SUPRIMENTOS

\' ===============================================

package \"3. M√≥dulo Estoque e Suprimentos\" {

class Item {

\+ id_item : long

\+ nome : String

\+ quantidadeTotal : int

\+ validade : Date

}

class Medicamento extends Item {

\+ prescricao: String

\+ targa : String

}

class Hospitalar extends Item {

\+ descartabilidade : boolean

}

class Alimento extends Item {

\+ alergenicos : String

}

class ProcedimentoItem {

\+ quantidadeNecessaria : Decimal

}

class Estoque {

\+ id_estoque : long

\+ local : String

}

class Pedido {

\+ id_pedido : long

\+ data_pedido : Date

\+ status : String

}

class Fornecedor {

\+ id_fornecedor : long

\+ cnpj : String

}

\' Camada de Persist√™ncia

interface EstoqueRepository \<\<Repository\>\> {

\+ darBaixa(itemId: Long, quantidade: int)

\+ buscarItemPorId(itemId: Long) : Item

}

\' Camada de Servi√ßo (Integra√ß√£o/Neg√≥cio)

class EstoqueService \<\<Service\>\> {

\- estoqueRepository : EstoqueRepository

\--

\+ darBaixa(itemId: Long, qtde: Integer)

\+ verificarEstoqueCritico(itemId: Long)

\+ solicitarReposicao(itemId: Long)

}

\' Implementa√ß√µes e Depend√™ncias Internas

EstoqueRepository \<\|.. EstoqueRepositoryImpl

EstoqueService o\--\> EstoqueRepository : usa

\' Rela√ß√µes de Dom√≠nio

Item \"1\" \-- \"0..\*\" ProcedimentoItem : componente de

\' NOTA: Relacionamento Item-Estoque n√£o implementado no Cassandra (ver Discrep√¢ncia 1.7)
\' MVP opera com estoque √∫nico impl√≠cito - design NoSQL sem joins

Pedido \"0..\*\" \-- \"0..\*\" Item : \<\<cont√©m\>\>

Pedido \"0..\*\" \-- \"1\" Fornecedor : √© feito a

}

\' ===============================================

\' INTEGRA√á√ÉO ENTRE M√ìDULOS VIA REDIS PUB/SUB

\' ===============================================

\' ARQUITETURA DESACOPLADA: M√≥dulos N√ÉO se chamam diretamente

\' Integra√ß√£o via Redis Pub/Sub para eventos:
\' - Agendamento publica: "consulta-agendada", "consulta-finalizada"
\' - Cadastro pode consumir: atualizar hist√≥rico de paciente
\' - Estoque pode consumir: reservar/dar baixa em insumos

\' Agendamento armazena APENAS identifica√ß√£o (n√£o objetos):
\' - pacienteCpf : String (n√£o objeto Paciente)
\' - medicoCrm : String (n√£o objeto Medico)
\' - convenioNome : String (n√£o objeto Convenio)

\' Valida√ß√£o de exist√™ncia: responsabilidade do frontend/controller
\' (consulta CadastroService antes de criar agendamento)

@enduml
```

### Diagrama Visual

![Diagrama Completo](images/classesGlobal.png)

---

## 3. M√≥dulo de Cadastro

M√≥dulo respons√°vel pelo cadastro e gerenciamento de pacientes, m√©dicos, usu√°rios e conv√™nios.

### C√≥digo PlantUML

```plantuml
@startuml

\' \-\-- Estilos Globais \-\--

skinparam package {

BackgroundColor PaleGreen

BorderColor DarkGreen

FontColor DarkGreen

}

skinparam class {

BackgroundColor LightYellow

BorderColor DarkGreen

ArrowColor #2F4F4F

}

skinparam interface {

BackgroundColor LightBlue

BorderColor DarkBlue

FontStyle Bold

}

hide empty members

\' ===============================================

\' PACOTE 1: M√ìDULO DE CADASTRO (CORE)

\' ===============================================

package \"1. M√≥dulo Cadastro (Core)\" {

class Pessoa \<\<Abstract\>\> {

\+ nomeCompleto : String

\+ telefone : String

\+ email : String

}

class Paciente extends Pessoa {

\+ dataNascimento : Date

\+ cpf : String {unique}

\+ verificarExistencia()

}

class Usuario extends Pessoa {

\+ login : String {unique}

\+ senha : String

\+ temPermissaoEncaixe() : Boolean

}

class Medico extends Pessoa {

\+ crm : String {unique}

\+ especialidade : String

}

class Convenio {

\+ nome : String

\+ plano : String

\+ ativo : Boolean

}

enum PerfilUsuario \<\<Enum\>\> {

MEDICO

SECRETARIA

GESTOR

FINANCEIRO

TESOURARIA

}

\' Camada de Persist√™ncia

interface PacienteRepository \<\<Repository\>\> {

\+ salvar(p: Paciente)

\+ buscarPorCpf(cpf: String) : Paciente

}

interface MedicoRepository \<\<Repository\>\> {

\+ buscarPorCrm(crm: String) : Medico

}

\' Camada de Servi√ßo (Integra√ß√£o/Neg√≥cio)

class CadastroService \<\<Service\>\> {

\- pacienteRepository : PacienteRepository

\- medicoRepository : MedicoRepository

\--

\+ registrarNovoPaciente(p: Paciente)

\+ buscarMedicoPorCrm(crm: String) : Medico

}

\' Implementa√ß√µes e Depend√™ncias Internas

PacienteRepository \<\|.. PacienteRepositoryImpl

MedicoRepository \<\|.. MedicoRepositoryImpl

CadastroService o\--\> PacienteRepository : usa

CadastroService o\--\> MedicoRepository : usa

Usuario \"1\" \-- \"1\" PerfilUsuario : tem

' REDU√á√ÉO DE ESCOPO 4.2: M√©dico-Conv√™nio n√£o implementado (sem @ManyToMany)


' CORRE√á√ÉO CARDINALIDADE 4.1: Um Paciente \"0..*\" -- \"0..1\" Convenio : possui plano


}

@enduml
```

### Diagrama Visual

![M√≥dulo Cadastro](images/classesCadastro.png)

---

## 4. M√≥dulo de Agendamento

M√≥dulo respons√°vel pelo agendamento de consultas, procedimentos e gest√£o da agenda m√©dica.

### C√≥digo PlantUML

```plantuml
@startuml

\' \-\-- Estilos Globais \-\--

skinparam package {

BackgroundColor PaleGreen

BorderColor DarkGreen

FontColor DarkGreen

}

skinparam class {

BackgroundColor LightYellow

BorderColor DarkGreen

ArrowColor #2F4F4F

}

skinparam interface {

BackgroundColor LightBlue

BorderColor DarkBlue

FontStyle Bold

}

hide empty members

\' ===============================================

\' PACOTE 2: M√ìDULO DE AGENDAMENTO

\' ===============================================

package \"2. M√≥dulo Agendamento\" {

class Agendamento {

\+ id : Integer

\+ dataHoraAgendamento : DateTime

\+ dataHoraInicioPrevista : DateTime

\+ dataHoraFimPrevista : DateTime

\+ dataHoraInicioExecucao : DateTime

\+ dataHoraFimExecucao : DateTime

\+ isEncaixe : Boolean

\+ modalidade : ModalidadeEnum

\+ motivoEncaixe : String \[Opcional\]

\+ observacoes : String

\+ status : StatusAgendamentoEnum

\+ motivoCancelamento : String

\+ dataCancelamento : DateTime

\+ pacienteCpf : String

\+ medicoCrm : String

\+ convenioNome : String

\+ usuarioCriadorLogin : String

\+ usuarioCanceladorLogin : String

\+ usuarioIniciouServicoLogin : String

\+ usuarioFinalizouServicoLogin : String

}

class Consulta extends Agendamento {

\+ especialidade : String

\+ tipoConsulta : Enum{primeira, retorno, rotina}

}

class Procedimento {

\+ descricaoProcedimento : String

\+ salaEquipamentoNecessario : String \[Opcional\]

\+ nivelRisco : String

}

class Exame {

\+ nomeExame : String

\+ requerPreparo : Boolean

\+ instrucoesPreparo : String \[Opcional\]

}

class BlocoAgenda {

\+ dataInicio : DateTime

\+ dataFim : DateTime

\+ motivo : String

\+ antecedenciaMinima : Integer {dias}

}

\' Camada de Persist√™ncia

interface AgendamentoRepository \<\<Repository\>\> {

\+ persistir(a: Agendamento)

\+ buscarPorPeriodo(data: Date) : List\<Agendamento\>

}

\' NOTA ARQUITETURAL: M√≥dulos desacoplados via eventos Redis

\' Camada de Servi√ßo (Integra√ß√£o/Neg√≥cio)

class AgendamentoService \<\<Service\>\> {

\- agendamentoRepository : AgendamentoRepository


\' REDU√á√ÉO DE ESCOPO: UC05 (Baixa Insumos) √© independente do Agendamento


\--

\+ criarAgendamento(a: Agendamento)

\+ verificaDisponibilidade(medicoId, dtInicio, dtFim) : Boolean


}

\' Implementa√ß√µes e Depend√™ncias Internas

AgendamentoRepository \<\|.. AgendamentoRepositoryImpl

AgendamentoService o\--\> AgendamentoRepository : usa

\' Rela√ß√µes de Dom√≠nio

Paciente \"1\" \-- \"0..\*\" Agendamento : paciente_em

Medico \"1\" \-- \"0..\*\" Agendamento : agenda_para

Convenio \"1\" \-- \"0..\*\" Agendamento : cobre_por

Usuario \"1\" \-- \"0..\*\" Agendamento : criado_por

Medico \"1\" \-- \"0..\*\" BlocoAgenda : registra

Procedimento \"0..\*\" \-- \"1\" Consulta : √© realizado em

Exame \"0..\*\" \-- \"1\" Consulta : √© solicitado em

Agendamento \"\*\" \-- \"\*\" ProcedimentoItem : requer

}

@enduml
```

### Diagrama Visual

![M√≥dulo Agendamento](images/classesAgendamento.png)

---

## 5. M√≥dulo de Estoque

M√≥dulo respons√°vel pelo controle de estoque, gest√£o de suprimentos e rastreabilidade de itens.

### C√≥digo PlantUML

```plantuml
@startuml

\' \-\-- Estilos Globais \-\--

skinparam package {

BackgroundColor PaleGreen

BorderColor DarkGreen

FontColor DarkGreen

}

skinparam class {

BackgroundColor LightYellow

BorderColor DarkGreen

ArrowColor #2F4F4F

}

skinparam interface {

BackgroundColor LightBlue

BorderColor DarkBlue

FontStyle Bold

}

hide empty members

\' ===============================================

\' PACOTE 3: M√ìDULO DE ESTOQUE E SUPRIMENTOS

\' ===============================================

package \"3. M√≥dulo Estoque e Suprimentos\" {

class Item {

\+ id_item : long

\+ nome : String

\+ quantidadeTotal : int

\+ validade : Date

}

class Medicamento extends Item {

\+ presciricao : String

\+ targa : String

}

class Hospitalar extends Item {

\+ descortabilidade : boolean

}

class Alimento extends Item {

\+ alergenicos : String

}

class ProcedimentoItem {

\+ quantidadeNecessaria : Decimal

}

class Estoque {

\+ id_estoque : long

\+ local : String

}

class Pedido {

\+ id_pedido : long

\+ data_pedido : Date

\+ status : String

}

class Fornecedor {

\+ id_fornecedor : long

\+ cnpj : String

}

\' Camada de Persist√™ncia

interface EstoqueRepository \<\<Repository\>\> {

\+ darBaixa(itemId: Long, quantidade: int)

\+ buscarItemPorId(itemId: Long) : Item

}

\' Camada de Servi√ßo (Integra√ß√£o/Neg√≥cio)

class EstoqueService \<\<Service\>\> {

\- estoqueRepository : EstoqueRepository

\--

\+ darBaixa(itemId: Long, qtde: Integer)

\+ verificarEstoqueCritico(itemId: Long)

\+ solicitarReposicao(itemId: Long)

}

\' Implementa√ß√µes e Depend√™ncias Internas

EstoqueRepository \<\|.. EstoqueRepositoryImpl

EstoqueService o\--\> EstoqueRepository : usa

\' Rela√ß√µes de Dom√≠nio

Item \"1\" \-- \"0..\*\" ProcedimentoItem : componente de

\' NOTA: Relacionamento Item-Estoque n√£o implementado no Cassandra (ver Discrep√¢ncia 1.7)
\' MVP opera com estoque √∫nico impl√≠cito - design NoSQL sem joins

Pedido \"0..\*\" \-- \"0..\*\" Item : \<\<cont√©m\>\>

Pedido \"0..\*\" \-- \"1\" Fornecedor : √© feito a

}

@enduml
```
### Diagrama Visual

![M√≥dulo Estoque](images/classesEstoque.png)

---
